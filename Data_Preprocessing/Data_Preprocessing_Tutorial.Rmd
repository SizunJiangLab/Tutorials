---
title: "Data Processing"
author: "Huaying Qiu"
date: "2024-01-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


This tutorial will introduce you to the standard data processing pipeline used in JiangLab. In short, the pipeline has five main components: 

1. Nucleus channel filter to filter out "fake" cells with minimal nucleus signal
2. Nucleus channel normalization to decrease the core-to-core variance if any
3. Arcsinh transformation to make the data less skewed
4. Trim off extreme/outliers at the lower and upper end of marker distribution
5. Transform the data to a range of [0,1] by quantile/percentile

In the following sections, these steps will be explored in detail. 

## Required libraries

```{r, message=FALSE}

library(tidyverse)
library(matrixStats)

```

## Example Data

In this tutorial, we will use a MIBI data set which was generated by Yunhao as an example. First, we will load the data using `read_csv` from the `tidyverse` package. After reading the dataframe, you should see its size from the environment tab or you can use `dim` to check yourself. For this particular dataframe, it contains 3335051 cells and 52 variables, within which 46 of them are protein markers. 

```{r, message=FALSE}

df <- read_csv('/mnt/nfs/home/huayingqiu/Tutorial/Data_processing/Betty_allRuns_REDSEA_raw.csv')

```

After reading the dataframe, we will use `summary` to briefly check the variables in the dataframe. We can see that this dataframe contains several identifiers such as cellLabel, X_cent, Y_cent, and pointNum which can help us identify where the cells come from. The rest of the variables are all protein markers and you can check the basic statistics from the output of `summary`. 

```{r}

summary(df)

```

The markers we have in this dataframe are

```{r}

colnames(df[,5:50])

```

Here, let's examine their distribution before the data is processed

```{r}



```



